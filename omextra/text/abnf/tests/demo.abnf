; ===============================
; ABNF "everything demo" grammar
; Exercises: rulename, =, =/, alternation, concatenation, repetition,
; grouping (), option [], comments, numeric %d/%x/%b with ranges & sequences,
; prose-val <...>, core rules (ALPHA, DIGIT, HEXDIG, WSP, CRLF), c-wsp via folding,
; default case-insensitive literals, RFC 7405 %s / %i strings.
; ===============================

; --- Entry point -----------------------------------------------------
config = *WSP header *(CRLF *WSP statement) [CRLF] *WSP
       ; concatenation, repetition, options, CRLF

header         = directive-line / comment-line
directive-line = %i"config" 1*WSP version CRLF
               ; %i = case-insensitive literal (RFC 7405)
               ; default "config" would already be case-insensitive in RFC 5234,
               ; shown explicitly here with %i.

version = "v" 1*DIGIT ["." 1*DIGIT]
        ; default quoted strings are case-insensitive in ABNF (5234).

comment-line = *WSP ";" *VCHAR CRLF
             ; ABNF comments (;) are out-of-band, but here we treat a line starting
             ; with ';' as an in-grammar "statement" comment.

; --- Statements (demonstrates incremental alternatives =/) -----------
statement = set-stmt
          / list-stmt
          / block-stmt
          / bytes-stmt
          / keyword-stmt

; Set statement: name = value
set-stmt = name *WSP "=" *WSP value

; List statement: items separated by commas, allowing line folding
list-stmt = name *WSP ":" *WSP value *(list-sep value)
list-sep  = *WSP "," *WSP
          / *(WSP / (CRLF 1*WSP)) "," *(WSP / (CRLF 1*WSP))
          ; Shows list separator that tolerates folded whitespace (c-wsp idea)

; Block statement: braces around zero or more inner statements
block-stmt = name *WSP "{" *(list-wsp statement) *list-wsp "}"
list-wsp   = *(WSP / (CRLF 1*WSP))
           ; c-wsp-like folding: allow line breaks where whitespace is permitted

; Keyword statement: demonstrates case-sensitive vs insensitive tokens
keyword-stmt = %s"ENABLE" / %s"DISABLE" / %i"debug"
             ; %s = case-sensitive, so only uppercase ENABLE/DISABLE match exactly.
             ; %i = case-insensitive, so any case of "debug" matches.

; Bytes statement: shows numeric terminals, ranges, sequences, and prose-val
bytes-stmt = %i"bytes" *WSP "=" *WSP ( hex-bytes / dec-bytes / bin-bytes / ascii-demo )
hex-bytes  = 1*(%x00-FF)  ; %x range over a single octet (00-FF)
dec-bytes  = 1*(%d0-255)  ; %d decimal range
ascii-demo = %x41.42.43   ; %x sequences with '.' -> "ABC"
           /  %d65.66.67  ; decimal sequence -> "ABC"

; --- Lexical pieces --------------------------------------------------
; Names: start ALPHA or "_", then 2*5 of (ALPHA / DIGIT / "_")
; demonstrates exact repetition n*m, bare n, max-limited *m, and grouping
name = (ALPHA / "_") 2*5(ALPHA / DIGIT / "_")
     ; at least 2 and at most 5 additional characters

; Values: alternation + grouping + optionals
value = number
      / quoted
      / boolean
      / identifier

; Number forms: integer or hex; precedence: repetition binds to the following element
number  = dec-int / hex-int
dec-int = ["-"] 1*DIGIT
hex-int = %i"0x" 1*HEXDIG

; Quoted strings: show escapes via numeric terminals and alternations
quoted = DQUOTE *qchar DQUOTE
qchar  = %x20-21 / %x23-5B / %x5D-7E  ; visible non-DQUOTE / non-backslash
       / %x5C DQUOTE                  ; \" (escaped quote)
       / %x5C %x5C                    ; \\ (escaped backslash)
       / HTAB / SP / %d9              ; mix of numeric forms (%d9 is HT, for show)

; Boolean: case-sensitive TRUE/FALSE and case-insensitive yes/no
boolean = %s"TRUE" / %s"FALSE" / %i"yes" / %i"no"

; Identifier: 1* (ALPHA / DIGIT / "_" / "-"), showing simple repetition
identifier = 1*(ALPHA / DIGIT / "_" / "-")

; --- Core terminals (from RFC 5234) used above ----------------------
; DQUOTE = %x22
; HTAB   = %x09
; SP     = %x20

; Note: DIGIT, ALPHA, HEXDIG, WSP, VCHAR, CRLF are core rules from RFC 5234 Appendix B.
; They are referenced directly and need not be redefined here.
